package com.moe.myapp;

import java.util.ArrayList;
import java.util.List;
import com.google.android.gms.maps.GoogleMap;
import com.google.android.gms.maps.GoogleMapOptions;
import com.google.android.gms.maps.MapFragment;
import com.google.android.gms.maps.model.LatLng;
import com.google.android.gms.maps.model.PolylineOptions;
import android.os.Bundle;
import android.app.ActionBar.LayoutParams;
import android.app.Activity;
import android.content.Intent;
import android.graphics.Color;

import android.view.Menu;
import android.widget.TableLayout;
import android.widget.TableRow;
import android.widget.TextView;

public class ViewRoute extends Activity {

	private GoogleMap mMap;

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.view_route);

		try {

			GoogleMapOptions options = new GoogleMapOptions();

			mMap = ((MapFragment) getFragmentManager().findFragmentById(
					R.id.map)).getMap();
			mMap.setMapType(GoogleMap.MAP_TYPE_HYBRID);

			mMap.setMyLocationEnabled(true);
			mMap.getMyLocation();

			Bundle bundle = getIntent().getExtras();
			// String []
			// String [] params={"1303HillsideTerrAlexandriaVA","FoggyBottomWashingtonDC"};
			String[] params = { bundle.getString("start"),
					bundle.getString("destination") };

			Route route = new GoogleAPIService().execute(params).get();

			route.drawRoute(mMap, route);
			route.drawMarkers(mMap, route);

			// //// populating view components with Route Info
			// TextView start= (TextView)findViewById(R.id.textViewStart);
			// TextView destination=
			// (TextView)findViewById(R.id.textViewDestination);
			// TextView distance= (TextView)findViewById(R.id.textViewDistance);
			// TextView waypoints=
			// (TextView)findViewById(R.id.textViewWaypoints);
			//
			// start.setText(route.getStart());
			// destination.setText(route.getDestination());
			// distance.setText(route.getLength() + "mi");
			String wayPointsString = "";

			for (int i = 0; i < route.getWayPointsTitles().length; i++) {
				wayPointsString += "(" + (i + 1) + ") "
						+ route.getWayPointsTitles()[i] + ".  ";

			}

			TableLayout lTableLayout;
			lTableLayout = (TableLayout) findViewById(R.id.tblayout);

			// //////////////////Route Name/////////////////////////////
			TableRow tr1 = new TableRow(this);
			tr1.setPadding(4, 4, 4, 4);
			lTableLayout.addView(tr1, LayoutParams.WRAP_CONTENT,
					LayoutParams.WRAP_CONTENT);
			TextView tv1 = new TextView(this);
			tv1.setText("Route Name: " + route.getName());
			tv1.setPadding(2, 2, 2, 2);
			tv1.setTextSize(12);
			tr1.addView(tv1, LayoutParams.WRAP_CONTENT,
					LayoutParams.WRAP_CONTENT); // Can give width and height in
												// numbers also.

			// //////////////////Route Start/////////////////////////////

			TableRow tr2 = new TableRow(this);
			tr2.setPadding(4, 4, 4, 4);
			lTableLayout.addView(tr2, LayoutParams.WRAP_CONTENT,
					LayoutParams.WRAP_CONTENT);
			TextView tv2 = new TextView(this);
			tv2.setText("Start: " + route.getStart());
			tv2.setPadding(2, 2, 2, 2);
			tv2.setTextSize(12);
			tr2.addView(tv2, LayoutParams.WRAP_CONTENT,
					LayoutParams.WRAP_CONTENT); // Can give width and height in
												// numbers also.

			// //////////////////Route Destination/////////////////////////////

			TableRow tr3 = new TableRow(this);
			tr3.setPadding(4, 4, 4, 4);
			lTableLayout.addView(tr3, LayoutParams.WRAP_CONTENT,
					LayoutParams.WRAP_CONTENT);
			TextView tv3 = new TextView(this);
			tv3.setText("Destination : " + route.getDestination());
			tv3.setPadding(2, 2, 2, 2);
			tv3.setTextSize(12);
			tr3.addView(tv3, LayoutParams.WRAP_CONTENT,
					LayoutParams.WRAP_CONTENT); // Can give width and height in
												// numbers also.

			// //////////////////Route Waypoints/////////////////////////////

			TableRow tr4 = new TableRow(this);
			tr4.setPadding(4, 4, 4, 4);
			lTableLayout.addView(tr4, LayoutParams.WRAP_CONTENT,
					LayoutParams.WRAP_CONTENT);
			TextView tv4 = new TextView(this);
			tv4.setText("Stops : " + wayPointsString);
			tv4.setPadding(2, 2, 2, 2);
			tv4.setTextSize(12);
			tr4.addView(tv4, LayoutParams.WRAP_CONTENT,
					LayoutParams.WRAP_CONTENT); // Can give width and height in
												// numbers also.

			// //////////////////Route Distance/////////////////////////////

			TableRow tr5 = new TableRow(this);
			tr5.setPadding(4, 4, 4, 4);
			lTableLayout.addView(tr5, LayoutParams.WRAP_CONTENT,
					LayoutParams.WRAP_CONTENT);
			TextView tv5 = new TextView(this);
			tv5.setText("Distance : " + route.getLength() + " mi");
			tv5.setPadding(2, 2, 2, 2);
			tv5.setTextSize(12);
			tr5.addView(tv5, LayoutParams.WRAP_CONTENT,
					LayoutParams.WRAP_CONTENT); // Can give width and height in
												// numbers also.

		} catch (Exception e) {
			e.printStackTrace();
		}

	}

	@Override
	public boolean onCreateOptionsMenu(Menu menu) {
		// Inflate the menu; this adds items to the action bar if it is present.
		getMenuInflater().inflate(R.menu.main, menu);
		return true;
	}

	@Override
	protected void onActivityResult(int requestCode, int resultCode, Intent data) {
		// TODO Auto-generated method stub
		super.onActivityResult(requestCode, resultCode, data);
		try {
			if (resultCode == RESULT_OK) {
				Bundle bundle = data.getExtras();
				Route route = (Route) bundle.getSerializable("Route");

				PolylineOptions polylineOptions = new PolylineOptions();

				List<LatLng> l = new ArrayList<LatLng>();
				l = route.getPoints();
				polylineOptions.addAll(l);
				polylineOptions.color(Color.YELLOW);
				polylineOptions.width(20);
				mMap.addPolyline(polylineOptions);
			}

		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

	}

}
